---
title: gcp에서 django 배포 -02- gcp 인스턴스 생성
date: 2023-09-01 21:17:13 +0900
categories: [Bloggings, django]
tags: [gcp, django, 서버, python]    # TAG names should always be lowercase
---




# gcp 가입 및 프로젝트 생성

구글 클라우드 처음 가입하면 36만원 정도인가 크레딧 줍니다. `300$` 정도
였던걸로 기억하는데 이정도면 `90일`동안 절대 다 못씁니다. 장고 프로젝트 말고 
k8s 구동해보려고 만들었는데 요긴하게 쓰는중입니다. 

## 2.1.1 gcp에서 할 일

> 이번 포스트에서 할 일
: gcp에 인스턴스(우분투)를 올리고, 
: 방화벽 접근 설정을 해제 해 줄 겁니다.
: gcloud cli로 인스턴스에 접속하여 체크(ssh대신에)


## 2.2.1 gcp 클라우드 가입 
[구글 클라우드 콘솔](https://console.cloud.google.com/)에 접속하여 가입을 진행 한 후, 
다음과 같은 화면을 마주하게 될 것 입니다.
<div>
<img src="https://i.ibb.co/hRqVVrz/Screenshot-2023-09-01-at-21-22-23.png" alt="Screenshot-2023-09-01-at-21-22-23">
</div>

 
* 상단의 my-project 화살표가 있는 곳을 클릭하여 새 프로젝트를 만들고,

## 2.3.1 인스턴스 생성

<div>
<img src="https://i.ibb.co/QN7jcG6/Screenshot-2023-09-01-at-22-23-52.png" alt="Screenshot-2023-09-01-at-22-23-52">
</div>

* 왼쪽 상단의 햄버거 메뉴를 펼쳐서 (메뉴) - (compute engine)- (vm instance)로 가줍니다.

인스턴스 만들기를 누루면 뭐가 많이 나오는데,
* 머신 구성: 컴퓨터 스펙 뭐로 할거냐는 이야기입니다. e2-small 
* os: 우분투 22.04 정도 (크게 상관은 없습니다 파이썬만 잘돌아가면 됩니다.)
* 리전: 아시아 , 영역: 아시아 (여기는 크게 상관 없습니다)
* ID 및 API 액세스: 모든 클라우드 api에 대해 허용 
* 방확벽설정:  http, https 둘다 허용해야하니까 체크

를 하고 만들어줍니다. 몇 분 걸리는데 머신이 생성되는 동안,
다음 스텝으로 넘어갑시다. 

## 2.4.1 방화벽 설정

* 아까 햄버거 메뉴탭을 다시 눌러서 (vpc 네트워크) - (방화벽)을 클릭해줍니다.

방화벽 관리에 들어와서, 

* 방화벽 규칙 만들기 클릭
* 이름은 아무거나 해줘도됩니다.
* 트래픽 방향 송신, 수신이 있는데 둘다 만들어 줘야합니다.
* 소스 ipv4 범위에 0.0.0.0/24를 입력해주고 
* 프로토콜 및 포트 모두허용 체크 해줍니다
* 같은 방법으로 송신도 만들어줍니다.

이제 이 세팅들이 되기까지 좀 기다려줍시다. 반영되는데 시간이 좀 걸립니다. 
그동안 다음스텝인 로컬(내 맥북)에서 gcloud 접속을 할 수 있게 해줄겁니다.

## 2.5.1 gcloud cli 

다른 aws나 뭐 외부 컴퓨터를 접속 할 때에 ssh를 많이 사용해 보셨을 겁니다. 
그리고 gcp에서도 aws와 같이 브라우저에서 바로 실행되는 터미널을 이용할 수 있습니다.
이러한 것들을 이용해도 되지만,

> gcp gcloud cli를 사용해봅시다 
: 내 로컬 터미널에서 (프로젝트명-번호)로 바로 비밀번호 치고 들어갈 수 있습니다. (이마저도 그냥 복사 붙여넣기 하면됩니다.)
: gcp가 권장하는 인스턴스 접근방식입니다.

### 2.5.2 gcloud 설치 경로

[gcloud cli 한글설치 문서](https://cloud.google.com/sdk/docs/install?hl=ko)
에 있는 다운로드 파일을 다운받을 겁니다.
홈 디렉터리에 설치를 해달라고 하니 터미널 zsh켜서 홈디렉터리를 체크.
```zsh
$ cd ~
$ pwd 
```
* 하면 나오는 경로를 복사(커맨드+c)해주세요. 
* 맥북 finder 켜고 커맨드+시프트+G 누르면 경로에 바로가기 창 뜹니다.
* 복붙(커맨드+v) 하면 바로 이동합니다. 

여기다 넣어주세요. 풀고 설치 다 한다음

### 2.5.3 gcloud 환경변수 추가하기

cli 설치 문서 밑에있는 환경변수 추가해주기를 해주세요.

```zsh
$  ./google-cloud-sdk/install.sh
$  ./google-cloud-sdk/bin/gcloud init
```
이 명령어 다 해주세요. 
* 첫번째 줄은 구글에서 만든 환경변수 추가해주는 스크립트이고,
* 두번째 줄은 설정 초기화입니다.

> **이제 gcloud로 시작하는 명령어를 터미널에서 쓸 수 있습니다!**

## 2.6.1 인스턴스 접속하기 & 비밀번호 설정
<div>
<img src="https://i.ibb.co/HN2nxK6/Screenshot-2023-09-01-at-21-24-34.png" alt="Screenshot-2023-09-01-at-21-24-34">
</div>

인스턴스 페이지로 돌아와서 보면 아까 만든 우분투가 보일겁니다.
* 그림에 있는 연결 밑에있는 저 (화살표) - (gcloud 커맨드 보기) 클릭.
* 오른쪽 옆에있는 복사 버튼 눌러서 
* 내 터미널에 붙여넣기. 
(tip.. mac에서는 이렇게 터미널에 붙여넣을 때 지우기(백스페이스)여러번 누르고 
붙여넣으시는 걸 추천합니다. 클립보드 버그가 나서 제대로 안들어가는 경우가 종종 있어요. or 플레인텍스트 같은 메모장에 한번 
붙여넣고 그걸 다시 복사해서 넣는 방법도 좋은 방법입니다.)

이러면 zsh쉘 왼쪽에 있는 계정정보가 바뀌면서 클라우드 인스턴스에 잘 접속한 모습이 뜰텐데,
* **처음이라 비밀번호 입력, 확인용 재입력 해야합니다.**

앞으로 계속 접속 할 때마다 쓸 비밀번호이니 잊지마세요.

`계정@인스턴스이름` << 터미널에 이렇게 뜨면 인스턴스에 잘 접속이 된 겁니다.

---
